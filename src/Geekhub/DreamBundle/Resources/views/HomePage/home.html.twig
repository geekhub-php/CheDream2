{% extends 'GeekhubResourceBundle::layout.html.twig' %}

{% block content %}

    {{ include('GeekhubDreamBundle:includes:homePageSlider.html.twig', {completedDreams: completedDreams}) }}
    
    <div>
        <div id="added_success"></div>

        <div id="dreams"></div>
    </div>

{% endblock %}
{% block javascript %}
    {{ parent() }}
    <script>
        var loadDreams = function(startIndex) {
            var path = Routing.generate('dream_ajax_loadMore_dreams');
                $.post(path, {offset : startIndex })
                        .done(function(response) {
                            $(response).appendTo($('#dreams')).hide().fadeIn(300);
                        })
                        .error(function(msg) {
                            console.log(msg);
                        }
                );
        };

        $(document).ready(function() {
            var startIndex = 0;
            loadDreams(startIndex);
            var load = false;
            $(window).scroll(function() {
                if($(window).height() + $(window).scrollTop() >= $(document).height() && !load) {
                    load = true;
                    startIndex = $('.dream-homepage-preview').length;
                    console.log(startIndex);
                    loadDreams(startIndex);
                    console.log('end document scrolled');
                    load = false;
                }
            });
        });

    </script>
    <script src="{{ asset('js/favorite.js') }}"></script>

{% endblock %}
