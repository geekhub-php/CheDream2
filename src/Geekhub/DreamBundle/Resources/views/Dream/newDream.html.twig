{% extends 'GeekhubResourceBundle::layout.html.twig' %}

{% block stylesheets %}
    <link href="{{ asset('css/dream_css.min.css') }}" rel="stylesheet">
{% endblock %}
{% block content %}
    <div class="page-header">
        <h1>New Dream <small>create or edit your dream</small></h1>
    </div>
    {#{{ form_start(form, {'attr': {'role': 'form', 'novalidate': 'novalidate' }}) }}#}
    {{ form_start(form) }}
    <div class="row">
        <div class="col-md-5">

            {#<div id="dream-poster-image">#}
                {#<img data-src="holder.js/440x260/text:Main Image" class="img-thumbnail">#}
            {#</div>#}

            {#<a href="#" class="thumbnail" data-toggle="modal" data-target="#uploadMainImage">#}
                {#<img data-src="holder.js/100%x200/text:Main Image">#}
            {#</a>#}

            <span class="fileinput-button" id="dream-poster-image">
                <div id="dream-poster-container">
                    <img data-src="holder.js/440x260/text:Main Image" class="img-thumbnail">
                    <input id="fileupload-poster" type="file" name="dream-poster">
                </div>
            </span>

            <br>
            <div id="dream-gallery"></div>
            <br/>
            <div id="dream-files"></div>
            <div id="dream-videos"></div>

            <div class="row">
                <div class="col-md-11">

                    <div id="dream-add-video">
                        <div class="row">
                            <div class="col-md-9 col-md-offset-1">
                                <div>
                                    <div id="dream-add-video-error"></div>
                                    <input type="text" class="form-control" id="dream-add-video-text-input">
                                </div>
                                <br/>
                                <div class="text-center">
                                    <input type="button" id="add-video-button" class="btn btn-info btn-xs" value="add video">
                                    <input type="button" id="add-video-button-cancel" class="btn btn-warning btn-xs" value="cancel">
                                </div>
                                <br/>
                            </div>
                        </div>
                    </div>

                    <span class="btn btn-success fileinput-button btn-xs pull-left" id="load-input" onclick="loadFile()">
                       <span> Додати файли...</span>
                        <input id="fileuploadz" type="file" name="files" multiple>
                    </span>

                    <span class="btn btn-xs btn-success pull-right" onclick="addDreamVideo()"> Add video</span>
                </div>
            </div>

            <br/>

            <div id="errors" class="files"></div>

        </div>
        <div class="col-md-7">
            {{ form_row(form.title) }}
            {{ form_row(form.description) }}
            {{ form_row(form.phone) }}
            {{ form_row(form.expiredDate) }}
            {{ form_row(form.tags) }}
            {{ form_widget(form.dreamPictures) }}
            {{ form_widget(form.dreamFiles) }}
            {{ form_widget(form.dreamVideos) }}
            {{ form_widget(form.dreamPoster) }}
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="col-md-4">
                <h4><span class="glyphicon glyphicon-euro"></span>&nbsp;&nbsp;FINANCE</h4>
                <ul class="financialResources" data-prototype="{{ form_widget(form.dreamFinancialResources.vars.prototype)|e }}">
                    {#{{ dump(form.financialResources) }}#}
                    {% for finance in form.dreamFinancialResources %}
                        <li>
                            {{ form_label(finance.title) }}
                            {{ form_widget(finance.title) }}
                        {#</li>#}
                        {#<li>#}
                            {{ form_label(finance.quantity) }}
                            {{ form_widget(finance.quantity) }}
                        </li><br/>
                        {#<li>{{ form_widget(finance.type) }}</li>#}
                    {% endfor %}
                </ul>
            </div>



            <div class="col-md-4">
                <h4><span class="glyphicon glyphicon-wrench"></span>&nbsp;&nbsp;EQUIPMENT</h4>
                <ul class="equipmentResources" data-prototype="{{ form_widget(form.dreamEquipmentResources.vars.prototype)|e }}">
                    {% for equipment in form.dreamEquipmentResources %}
                        <li>
                            {{ form_label(equipment.title) }}
                            {{ form_widget(equipment.title) }}
                        {#</li>#}
                        {#<li>#}
                            {{ form_label(equipment.quantity) }}
                            {{ form_widget(equipment.quantity) }}
                        {#</li>#}
                        {#<li>#}
                            {{ form_label(equipment.quantityType) }}
                            {{ form_widget(equipment.quantityType) }}
                        </li><br/>
                        {#<li>{{ form_widget(equipment.type) }}</li>#}
                    {% endfor %}
                </ul>
            </div>

            <div class="col-md-4">
                <h4><span class="glyphicon glyphicon-user"></span>&nbsp;&nbsp;WORK</h4>
                <ul class="workResources" data-prototype="{{ form_widget(form.dreamWorkResources.vars.prototype)|e }}">
                    {% for work in form.dreamWorkResources %}
                        <li>
                            {{ form_label(work.title) }}
                            {{ form_widget(work.title) }}
                        {#</li>#}
                        {#<li>#}
                            {{ form_label(work.quantity) }}
                            {{ form_widget(work.quantity) }}
                        {#</li>#}
                        {#<li>#}
                            {{ form_label(work.quantityDays) }}
                            {{ form_widget(work.quantityDays) }}
                        </li><br/>
                        {#<li>{{ form_widget(work.type) }}</li>#}
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
    <div class="hidden">
        {{ form_rest(form) }}
    </div>

        <br>
         <input type="submit" value="Create Dream" class="text-center btn btn-primary">
        {{ form_row(form._token) }}
    {{ form_end(form) }}
    {% include 'GeekhubDreamBundle:includes:dreamMainImageModal.html.twig' %}
{% endblock %}

{% block javascript %}
{{ parent() }}
<script src="{{ asset('js/dream.min.js') }}"></script>

<script>
    $(document).ready(function() {
        $('#dream-add-video').hide();
    });

    $('#dream-poster-image').click(function() {
        var url = Routing.generate('dream_ajax_load_poster');
        $('#fileupload-poster').fileupload({
            url: url,
            dataType: 'json',
            done: function (e, data) {
                var responseArr = JSON.parse(data.jqXHR.responseText);
                $.each(responseArr, function (index, file) {
                    if(file.error){
                        $('#errors').append(
                                '<div class="alert alert-danger">' + file.src + ' <strong>' +file.error + '</strong>' +
                                        '&nbsp; &nbsp; <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button> &nbsp;&nbsp; ' +
                                        '</div>'
                        );

                        return;
                    }
                    if(file.type == 'image' && file.error == null) {
                        $('#dream-poster-container').html('<img src="' + file.srcPreview + '" class="img-thumbnail">' +
                                '<input id="fileupload-poster" type="file" name="dream-poster">');
                        $('#newDreamForm_dreamPoster').get(0).value = file.src;
                    }
                });

            },
            error: function(msg) {
                console.log('error = ' + msg);
                console.dir(msg);
            }
        });
    });

    loadFile = function () {
//            'use strict';
//        var url = Routing.generate('media_upload_images');
        var url = Routing.generate('dream_ajax_load_image');
        $('#fileuploadz').fileupload({
            url: url,
            dataType: 'json',
            done: function (e, data) {
                var responseArr = JSON.parse(data.jqXHR.responseText);
                $.each(responseArr, function (index, file) {
                    if(file.error){
                        $('#errors').append(
                                '<div class="alert alert-danger">' + file.src + ' <strong>' +file.error + '</strong>' +
                                '&nbsp; &nbsp; <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button> &nbsp;&nbsp; ' +
                                '</div>'
                        );

                        return;
                    }
                    if(file.type == 'image' && file.error == null) {
                        $('#dream-gallery').append('<img src="' + file.srcPreview + '" class="img-thumbnail">');
                        $('#newDreamForm_dreamPictures').get(0).value += ',' + file.src;
                    }
                    if(file.type == 'file' && file.error == null) {
                        $('#dream-files').append(
                                '<div class="alert alert-info">' +
                                '<span class="glyphicon glyphicon-file"></span>' + ' ' + file.name +
                                '</div>'
                                );
                        $('#newDreamForm_dreamFiles').get(0).value += ',' + file.src;
                    }
                });
            },
            error: function(msg) {
                console.log('error = ' + msg);
                console.dir(msg);
            }
        });
    };

    addDreamVideo = function() {
        $('#dream-add-video').fadeIn(500).show();
    };

    $('#add-video-button').click(function() {
        var videoSrc = $('#dream-add-video-text-input').get(0).value;
        if (videoSrc != '' ) {
        $('#newDreamForm_dreamVideos').get(0).value += ',' + videoSrc;
        $('#dream-add-video-text-input').get(0).value = '';
        $('#dream-add-video').fadeOut(500).hide();

        $('#dream-videos').append(
                '<div class="alert alert-warning">' +
                        '<i class="icon icon-youtube"></i>' + ' ' + '<a href="'+ videoSrc +'" target="_blank" >' + 'Youtube video' + '</a>' +
                        '</div>'
        );
            $('#dream-add-video-error').html('');
        } else {
            $('#dream-add-video-error').html(
                    '<div class="alert alert-warning alert-dismissable">' +
                    '<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>' +
                    '<strong>Увага!</strong> Ви не додали адресу на відео' +
                    '</div>'
            );
        }
    });

    $('#add-video-button-cancel').click(function() {
        $('#dream-add-video-error').html('');
        $('#dream-add-video-text-input').get(0).value = '';
        $('#dream-add-video').fadeOut(500).hide();
    });


</script>

{% endblock %}
